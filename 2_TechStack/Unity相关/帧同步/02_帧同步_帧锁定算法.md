
**算法概念**

1．客户端定时（比如每五帧）上传控制信息。  
2．服务器收到所有控制信息后广播给所有客户。  
3．客户端用服务器发来的更新消息中的控制信息进行游戏。  
4．如果客户端进行到下一个关键帧（5帧后）时没有收到服务器的更新消息则等待。  
5．如果客户端进行到下一个关键帧时已经接收到了服务器的更新消息，则将上面的数据用于游戏，并采集当前鼠标键盘输入发送给服务器，同时继续进行下去。  
6．服务端采集到所有数据后再次发送下一个关键帧更新消息。



**客户端逻辑：**

1. 判断当前帧 F 是否关键帧 K1：如果不是跳转（7）。
2. 如果是关键帧，则察看有没有 K1 的 UPDATE 数据，如果没有的话重复第 2 步等待。 ---- 是否叠加？还是？
3. 采集当前 K1 的输入作为 CTRL 数据与 K1 编号一起发送给服务器
4. 从 UPDATE K1 中得到下一个关键帧的号码 K2 以及到下一个关键帧之间的输入数据 I。
5. 从这个关键帧到下 一个关键帧 K2 之间的虚拟输入都用I。
6. 令 K1 = K2。
7. 执行该帧逻辑
8. 跳转（1）

**服务端逻辑：**

1．收集所有客户端本关键帧 K1 的 CTRL 数据（Ctrl-K）等待知道收集完成所有的 CTRL-K。  
2．根据所有 CTRL-K，计算下一个关键帧 K2 的 Update，计算再下一个关键帧的编号 K3。  
3．将 Update 发送给所有客户端  
4．令 K1=K2  
5．跳转（1）

**总结**

逻辑帧按照服务器发送的帧计算，如果一方卡住，则两方都卡住。

